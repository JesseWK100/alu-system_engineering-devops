#!/usr/bin/env bash
# Script to configure Nginx with a custom 404 page.

# Exit on errors
set -e

# Update and install Nginx
sudo apt update
sudo apt install -y nginx

# Create the custom 404 page directory and file
sudo mkdir -p /var/www/html/errors
echo "Ceci n'est pas une page" | sudo tee /var/www/html/errors/404.html

# Configure Nginx to use the custom 404 page
NGINX_CONF="/etc/nginx/sites-available/default"
sudo sed -i '/server {/a\    error_page 404 /errors/404.html;' $NGINX_CONF
sudo sed -i '/server {/a\    location = /errors/404.html { root /var/www/html; internal; }' $NGINX_CONF

# Reload Nginx to apply changes
sudo nginx -t
sudo systemctl reload nginx

# Ensure proper permissions
sudo chown -R www-data:www-data /var/www/html/errors
